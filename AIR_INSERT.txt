Failed to add the foreign key constraint. Missing column 'MEMBER_ID' for constraint 'airbook_ibfk_1' in the referenced table 'member'

UPDATE MEMBER SET STATUS_NUM = 1;

-- 뷰 삭제
DROP VIEW TICKET_VIEW; 
DROP VIEW AIRBOOK_VIEW;
DROP VIEW AIRDET_VIEW;

-- 테이블 삭제
DROP TABLE AIRBOOK;
DROP TABLE AIRDET;
DROP TABLE AIROPT;
DROP TABLE AIRINFO;
DROP TABLE MEMBER;
DROP TABLE STATUS;

-- 테이블 확인
SELECT * FROM STATUS;
SELECT * FROM MEMBER;
SELECT * FROM AIRINFO;
SELECT * FROM AIROPT;
SELECT * FROM AIRDET;
SELECT * FROM AIRBOOK;

-- 회원등급 테이블
CREATE TABLE STATUS(
	STATUS_NUM INT PRIMARY KEY AUTO_INCREMENT,
	STATUS_NAME VARCHAR(10) NOT NULL
);

-- 회원 테이블
CREATE TABLE MEMBER(
	MEMBER_ID VARCHAR(30) BINARY PRIMARY KEY,
	MEMBER_PW VARCHAR(30) BINARY NOT NULL,
	MEMBER_NAME VARCHAR(30) NOT NULL,
	STATUS_NUM INT NOT NULL DEFAULT 2,
	FOREIGN KEY(STATUS_NUM) REFERENCES STATUS(STATUS_NUM) ON DELETE CASCADE
);

-- 항공정보 테이블
CREATE TABLE AIRINFO(
	AIRINFO_NUM INT PRIMARY KEY AUTO_INCREMENT,
	AIRINFO_AIRLINE VARCHAR(30) NOT NULL,
	AIRINFO_ROUTE VARCHAR(30) NOT NULL,
	AIRINFO_START TIME NOT NULL,
	AIRINFO_RETURN TIME NOT NULL,
	AIRINFO_PRICE INT NOT NULL,
	AIRINFO_DATE DATE NOT NULL DEFAULT (CURRENT_DATE)
);

-- 항공옵션 테이블
CREATE TABLE AIROPT(
	AIROPT_NUM INT PRIMARY KEY AUTO_INCREMENT,
	AIROPT_GRADE VARCHAR(30) NOT NULL,
	AIROPT_PRICE INT NOT NULL
);

-- 항공상세 테이블
CREATE TABLE AIRDET(
	AIRDET_NUM INT PRIMARY KEY AUTO_INCREMENT,
	AIRINFO_NUM INT NOT NULL,
	AIROPT_NUM INT NOT NULL,
	AIRDET_CNT INT NOT NULL,
	FOREIGN KEY(AIRINFO_NUM) REFERENCES AIRINFO(AIRINFO_NUM) ON DELETE CASCADE,
	FOREIGN KEY(AIROPT_NUM) REFERENCES AIROPT(AIROPT_NUM) ON DELETE CASCADE
);

-- 항공예매 테이블
CREATE TABLE AIRBOOK(
	AIRBOOK_NUM INT PRIMARY KEY AUTO_INCREMENT,
	MEMBER_ID VARCHAR(30) BINARY NOT NULL,
	AIRDET_NUM INT NOT NULL,
	AIRBOOK_CNT INT NOT NULL,
	AIRBOOK_CARD VARCHAR(16) NOT NULL,
	AIRBOOK_DATE DATE DEFAULT (CURRENT_DATE),
	FOREIGN KEY(MEMBER_ID) REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE,
	FOREIGN KEY(AIRDET_NUM) REFERENCES AIRDET(AIRDET_NUM) ON DELETE CASCADE
);

-- 항공상세 뷰
CREATE VIEW AIRDET_VIEW
AS
(
	SELECT ad.AIRDET_NUM, ai.AIRINFO_NUM, ai.AIRINFO_AIRLINE, ai.AIRINFO_ROUTE, ai.AIRINFO_START, ai.AIRINFO_RETURN, (ai.AIRINFO_PRICE * ao.AIROPT_PRICE) AS PRICE, ai.AIRINFO_DATE, ao.AIROPT_GRADE, ad.AIRDET_CNT
	FROM AIRDET ad JOIN AIRINFO ai USING(AIRINFO_NUM)
		       JOIN AIROPT ao USING(AIROPT_NUM) ORDER BY ad.AIRDET_NUM ASC
);

-- 항공예매 뷰
CREATE VIEW AIRBOOK_VIEW
AS
(
SELECT ab.AIRBOOK_NUM, MEMBER_ID, AIRDET_NUM, AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_DATE, ab.AIRBOOK_DATE, ab.AIRBOOK_CARD, AIROPT_GRADE, ab.AIRBOOK_CNT, (PRICE * ab.AIRBOOK_CNT) AS TOTAL_PRICE
	FROM AIRDET_VIEW ad_v JOIN AIRBOOK ab USING(AIRDET_NUM) ORDER BY ab.AIRBOOK_NUM ASC
);

-- 티켓 형태로 출력을 위한 뷰
Create View TICKET_VIEW AS
SELECT A.AIRINFO_NUM, E.MEMBER_NAME, C.AIROPT_GRADE, A.AIRINFO_ROUTE, A.AIRINFO_START, A.AIRINFO_RETURN, A.AIRINFO_PRICE, A.AIRINFO_DATE, D.AIRBOOK_NUM
FROM AIRINFO AS A
LEFT JOIN AIRDET AS B
   ON A.AIRINFO_NUM = B.AIRINFO_NUM

LEFT JOIN AIROPT AS C
    ON C.AIROPT_NUM = B.AIROPT_NUM

LEFT JOIN AIRBOOK AS D
    ON D.AIRDET_NUM = B.AIRDET_NUM

LEFT JOIN MEMBER AS E
    ON E.MEMBER_ID = D.MEMBER_ID;

=============================================================================================================================

INSERT INTO STATUS (STATUS_NAME) VALUES ('관리자');
INSERT INTO STATUS (STATUS_NAME) VALUES ('사용자');

INSERT INTO MEMBER VALUES ('admin001', '1234', '관리자1', 1);
INSERT INTO MEMBER VALUES ('admin002', '1234', '관리자2', 1);
INSERT INTO MEMBER VALUES ('user001', '1234', '아무개', 2);
INSERT INTO MEMBER VALUES ('user002', '1234', '홍길동', 2);
INSERT INTO MEMBER VALUES ('user003', '1234', '홍길순', 2);

INSERT INTO AIRINFO (AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE) VALUES ('대한항공', '김포-제주', '20:20', '22:20', 69100);
INSERT INTO AIRINFO (AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE) VALUES ('아시아나항공', '제주-청주', '06:00', '07:30', 83100);
INSERT INTO AIRINFO (AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE) VALUES ('제주항공', '김포-여수', '14:10', '16:10', 86500);
INSERT INTO AIRINFO (AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE) VALUES ('진에어', '김포-제주', '20:20', '22:20', 69100);

INSERT INTO AIROPT (AIROPT_GRADE, AIROPT_PRICE) VALUES ('이코노미', 1);
INSERT INTO AIROPT (AIROPT_GRADE, AIROPT_PRICE) VALUES ('비즈니스', 3);
INSERT INTO AIROPT (AIROPT_GRADE, AIROPT_PRICE) VALUES ('퍼스트', 10);

INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (1, 1, 294);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (1, 2, 86);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (1, 3, 13);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (2, 1, 256);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (2, 2, 91);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (2, 3, 17);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (3, 1, 283);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (3, 2, 59);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (3, 3, 4);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (4, 1, 301);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (4, 2, 75);
INSERT INTO AIRDET (AIRINFO_NUM, AIROPT_NUM, AIRDET_CNT) VALUES (4, 3, 12);

INSERT INTO AIRBOOK (MEMBER_ID, AIRDET_NUM, AIRBOOK_CNT, AIRBOOK_CARD) VALUES ('user001', 4, 2, 5478541256480541);
INSERT INTO AIRBOOK (MEMBER_ID, AIRDET_NUM, AIRBOOK_CNT, AIRBOOK_CARD) VALUES ('user001', 5, 1, 5478541256480541);
INSERT INTO AIRBOOK (MEMBER_ID, AIRDET_NUM, AIRBOOK_CNT, AIRBOOK_CARD) VALUES ('user002', 7, 1, 1245764121547642);
INSERT INTO AIRBOOK (MEMBER_ID, AIRDET_NUM, AIRBOOK_CNT, AIRBOOK_CARD) VALUES ('user003', 2, 3, 3274672459645175);
INSERT INTO AIRBOOK (MEMBER_ID, AIRDET_NUM, AIRBOOK_CNT, AIRBOOK_CARD) VALUES ('user003', 3, 5, 9478528942572858);

-- 예매한 항공권 별 항공정보 예매
SELECT AIRINFO_NUM, AIRINFO_AIRLINE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE FROM AIRDET JOIN AIRBOOK USING(AIRDET_NUM) JOIN AIRINFO USING(AIRINFO_NUM) GROUP BY AIRINFO_NUM ORDER BY COUNT(AIRINFO_NUM) DESC;

-- 티켓 뷰 출력
SELECT AIRINFO_NUM, MEMBER_NAME, AIROPT_GRADE, AIRINFO_ROUTE, AIRINFO_START, AIRINFO_RETURN, AIRINFO_PRICE, AIRINFO_DATE
FROM TICKET2_VIEW
WHERE AIRBOOK_NUM = ?;


